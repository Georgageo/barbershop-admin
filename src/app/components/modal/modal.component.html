@if (visible) {
  <div
    class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm"
    (click)="onOverlayClick()"
    role="dialog"
    aria-modal="true"
    [attr.aria-label]="title ?? 'Dialog'"
  >
    <div
      class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto border border-slate-200 dark:border-slate-700"
      (click)="$event.stopPropagation()"
    >
      @if (title) {
        <div class="p-6 border-b border-slate-200 dark:border-slate-700">
          <h3 class="text-xl font-bold text-slate-800 dark:text-white">{{ title }}</h3>
        </div>
      }
      <form [id]="formId ?? null" (ngSubmit)="onSubmit()" class="p-6 grid grid-cols-2 gap-x-4 gap-y-5">
        @if (errorMessage) {
          <div
            class="col-span-2 rounded-xl bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-800 dark:text-red-300 px-4 py-3 text-sm"
          >
            {{ errorMessage }}
          </div>
        }

        @for (field of fields; track field.key) {
          <div [class.col-span-2]="(field.width ?? 'full') === 'full'" [class.col-span-1]="field.width === 'half'">
            <label [for]="field.key" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              {{ field.label }}
              @if (field.required) {
                <span class="text-red-500">*</span>
              }
            </label>

            @switch (field.type) {
              @case ('textarea') {
                <textarea
                  [id]="field.key"
                  [(ngModel)]="model[field.key]"
                  [name]="field.key"
                  [maxlength]="field.maxLength ?? null"
                  [rows]="field.rows ?? 3"
                  [placeholder]="field.placeholder ?? ''"
                  class="w-full px-4 py-2.5 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-cyan-500 resize-none"
                ></textarea>
              }
              @case ('checkbox') {
                <div class="flex items-center gap-2">
                  <input
                    [id]="field.key"
                    type="checkbox"
                    [(ngModel)]="model[field.key]"
                    [name]="field.key"
                    class="rounded border-slate-300 text-cyan-500 focus:ring-cyan-500"
                  />
                  <label [for]="field.key" class="text-sm font-medium text-slate-700 dark:text-slate-300">
                    {{ field.placeholder ?? field.label }}
                  </label>
                </div>
              }
              @case ('select') {
                <select
                  [id]="field.key"
                  [(ngModel)]="model[field.key]"
                  [name]="field.key"
                  [required]="field.required ?? false"
                  class="w-full px-4 py-2.5 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-cyan-500"
                >
                  <option value="">{{ field.placeholder ?? 'â€”' }}</option>
                  @for (opt of field.options ?? []; track opt.value) {
                    <option [value]="opt.value">{{ opt.label }}</option>
                  }
                </select>
              }
              @default {
                <input
                  [id]="field.key"
                  [type]="field.type"
                  [(ngModel)]="model[field.key]"
                  [name]="field.key"
                  [required]="field.required ?? false"
                  [maxlength]="field.maxLength ?? null"
                  [min]="field.min ?? null"
                  [max]="field.max ?? null"
                  [step]="field.step ?? null"
                  [placeholder]="field.placeholder ?? ''"
                  class="w-full px-4 py-2.5 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-cyan-500"
                />
              }
            }

            @if (field.hint) {
              <p class="text-xs text-slate-500 dark:text-slate-400 mt-1">{{ field.hint }}</p>
            }
          </div>
        }
      </form>
      <div class="px-6 pb-6 pt-4 border-t border-slate-200 dark:border-slate-700">
        <ng-content select="[appModalActions]" />
      </div>
    </div>
  </div>
}
